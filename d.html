<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>D3.js v4: Panning with mouse wheel</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.12.2/d3.min.js"></script>
  <style>


  </style>
</head>
<body>
<script>
    var width = 960,
        height = 500;



    var data = d3.range(2000).map(function() {return 1;});

    // let gradient_color_list = [
    //     "#f9d057",
    //     "#f9d057",
    //     "#e76818",
    //     "#fc4e2a",
    //     "#bd0026",
    //     "#67000d"
    // ];
    // gradient_color_list = ["#F6CAD9","#E6A3B6", "#B05E6A", "#984B53", "#6E3132", 'black'];
    let gradient_color_list = [
        "#ffffcc",
        "#f9d057",
        "#e76818",
        "#e31a1c",
        "#bd0026",
        "#67000d"
    ];

    let dataList = [0,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1];

    let colorScaleRainbow = d3.scaleLinear()
        .domain([0.0,0.2,0.4,0.5, 0.7, 1])
        .range(gradient_color_list)
        .interpolate(d3.interpolateHcl);


    let max_val = 150;
    for(let i = 0, ilen  = dataList.length; i < ilen; i++){
        console.log(i, dataList[i], colorScaleRainbow(dataList[i]))
    }

    let svg = d3.select('body').append('svg').attr('width', 1000).attr('height', 1000)

    let container = svg.append('g').attr('transform', 'translate(40, 100)');
    var gradient = container.append('defs')
        .append('linearGradient')
        .attr('id', 'gradient')
        .attr('x1', '0%') // bottom
        .attr('y1', '00%')
        .attr('x2', '0%') // to top
        .attr('y2', '100%')
        .attr('spreadMethod', 'pad');
    function percentange(start, end, val){
        return val / (end - start) * 100 + '%'
    }
    let start = dataList[0];
    let end = dataList[dataList.length - 1];
    dataList.forEach((d, i)=>{
        gradient.append('stop')
            .attr('offset', percentange(start, end, d))
            .attr('stop-color', colorScaleRainbow(d))
            .attr('stop-opacity', 1);
    });
    let legendHeight = 200;
    let legendWidth = 20;
    container.append('rect')
        .attr('y', -1)
        .attr('width', legendWidth)
        .attr('height', legendHeight + 2)
        .style('fill', 'url(#gradient)');

    console.log('range', dataList, d3.extent(dataList))
    var legendScale = d3.scaleLinear()
        .domain(d3.extent(dataList))
        .range([0, legendHeight]);

    let rects = container.selectAll('rect').data(dataList).enter().append('rect')
        .attr('x', legendWidth).attr('y', d=>legendScale(d))
        .attr('width', 5).attr('height', 5)
        .attr('fill', d=> colorScaleRainbow(d))

    var legendAxis = d3.axisLeft()
        .scale(legendScale)
        .tickFormat((d,i)=>(d - start) / (end - start) * max_val)
    let axisContainer = container.append("g")
        .attr("class", "legend axis")
        .attr("transform", "translate(" + -2 + ", 0)")
        .call(legendAxis);
    let axisColor = 'grey'
    axisContainer.selectAll('path').attr('stroke', axisColor);
    axisContainer.selectAll('line').attr('stroke', axisColor);
    axisContainer.selectAll('text').attr('fill', axisColor);
    container.append('text').attr('x', -20).attr('y', legendHeight + 20).text('Unit: ug/m3')
        .attr('font-size', 10).attr('fill', 'grey')

</script>
</body>
</html>

